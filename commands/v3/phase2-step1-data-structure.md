---
allowed-tools: ["Read", "Write", "Edit", "Bash"]
description: "システムのデータ構造をER図で定義"
---

# Step4: データ構造の定義

## 共通指示の参照
/v3:common-instructions

## 概要
システムが扱うデータの構造を**ER図**（エンティティ関係図）として定義します。これにより、エンティティごとの属性、それらの間のリレーションシップを明確にします。

## 実行手順

### 1. 前ステップの成果物を確認
* Phase1-Step1（アイデアと目標）
* Phase1-Step2（ユーザー要件定義）
* Phase1-Step3（ユーザーインタラクション）

### 2. 基本的な初期手順
共通指示に従い、日時取得とディレクトリ準備を実行してください。

### 3. 不足情報の特定と質問
前ステップの成果物を確認し、データ構造設計に必要な情報を質問してください：

**確認すべき項目:**
- システムで管理すべきデータは明確ですか？
- データ間の関係性は理解できていますか？
- データのライフサイクル（作成・更新・削除）はどうなりますか？
- パフォーマンスやスケーラビリティの要件はありますか？
- データの整合性やセキュリティ要件はありますか？

### 4. 対話的情報収集
以下のようにデータ設計に必要な情報を質問してください：

```
データ構造設計のため、以下について詳しく教えてください：

1. システムで管理するデータ
   - 主要なデータオブジェクトは何ですか？
   - 各データが持つべき情報（属性）は何ですか？

2. データ間の関係
   - どのデータとどのデータが関連していますか？
   - 一対一、一対多、多対多のどの関係ですか？

3. データの制約条件
   - 必須項目や一意性の制約はありますか？
   - データの範囲やフォーマットの制約はありますか？

4. 非機能要件
   - どの程度のデータ量を想定していますか？
   - アクセス頻度やレスポンス時間の要件はありますか？
```

### 5. データ構造設計案の提示と承認
収集した情報を基に、以下の形式でデータ構造設計案を提示してください：

```
以下のデータ構造設計でStep4のドキュメントを作成します。内容をご確認ください：

## エンティティ定義
[主要なデータオブジェクトとその属性]

## ER図
[Mermaid記法でのER図]

## リレーションシップ
[エンティティ間の関係性]

## テーブル定義（DDL）
[CREATE TABLE文]

## 制約条件
[一意性制約、外部キー制約等]

この内容で問題ありませんか？修正や追加が必要な箇所があれば教えてください。
```

以下の要素を含めて設計してください：

**データモデル設計要素:**
- **エンティティ定義**: システムで管理する主要なデータオブジェクト
- **属性定義**: 各エンティティが持つプロパティとデータ型
- **リレーションシップ**: エンティティ間の関係性（1対1、1対多、多対多）
- **制約条件**: 一意性制約、外部キー制約、チェック制約
- **インデックス設計**: パフォーマンス最適化のための索引

**ER図の構成要素:**
1. **エンティティ**: 四角形で表現
2. **属性**: 楕円形で表現（主キーは下線）
3. **リレーションシップ**: ひし形で表現
4. **カーディナリティ**: 関係の多重度を明記

### 4. データベース設計書の作成
以下の内容を含むデータベース設計書を作成してください：
- **論理データモデル**: ER図
- **物理データモデル**: テーブル定義（DDL含む）
- **データディクショナリ**: 各属性の詳細仕様
- **正規化レベル**: 第何正規形まで適用するか

### 5. Mermaid記法でのER図作成
ER図はMermaid記法で記述し、可視化可能な形で文書化してください。

### 6. フィードバック反映とドキュメント作成
共通指示で定義されたファイル出力パス構造に従い、最終的に承認された内容でドキュメントを作成してください。

## 依存関係
- **依存元**: Phase1-Step1-3（ユーザー要件から導き出されるデータ要件）
- **依存先**: Phase2-Step2（システム全体データフロー）、Phase2-Step3（API設計）、Phase3-Step2（実装設計）

## 出力成果物
共通指示で定義されたパス構造に従って成果物を出力してください。

## 重要な対話ポイント
- データオブジェクトが曖昧な場合は、具体的なサンプルデータを例示して明確化してください
- 技術的制約（データベース種類、パフォーマンス要件）を確認して現実的な設計を行ってください
- 正規化レベルについてはユーザーの理解レベルに合わせて説明してください
- 将来の機能拡張やデータ量増加への対応も考慮した設計を心がけてください
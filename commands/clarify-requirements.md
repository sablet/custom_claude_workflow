---
allowed-tools: ["Read", "Grep", "Glob", "Write"]
description: "要求分析：曖昧な要求から実装可能な仕様を定義"
---

# 要求分析・明確化: $ARGUMENTS

## 既存コードベース調査

### 関連ファイル・機能の特定
既存の類似機能・関連モジュールを調査し、実装パターンと統合方法を把握する

## 要求分析（全体フロー向け）

### What (何を実現するか)
**機能の本質**
- [ ] **主要機能**: [ユーザー要求から導出される核となる機能]
- [ ] **入力データ**: [処理対象となるデータの種類・形式]
- [ ] **出力結果**: [生成される結果・成果物の形式]
- [ ] **計算・処理ロジック**: [入力から出力への変換処理の特性]

**機能スコープ**
- [ ] **責任範囲**: [この機能が担当する処理の境界]
- [ ] **対象外範囲**: [意図的に除外する機能・処理]
- [ ] **既存機能との関係**: [利用・拡張・置換する既存コンポーネント]

### Why (なぜ必要か)
**解決したい課題**
- [ ] **現在の問題**: [既存の制約・不足・非効率性]
- [ ] **目標とする改善**: [実装により達成したい状態]
- [ ] **対象ユーザー**: [この機能の利用者・受益者]

**技術的背景**
- [ ] **技術的制約**: [現在のアーキテクチャで対応困難な理由]
- [ ] **システム上の位置づけ**: [全体アーキテクチャにおける役割]
- [ ] **発展可能性**: [将来的な機能拡張・改良の方向性]

## 成果物定義（実装指向）

### 1. 実装対象ファイル（レイヤード設計）
**新規作成**
- [ ] `src/service/[feature_service].py` - [ビジネスロジック層]
- [ ] `src/models/[feature_model].py` - [ドメインモデル層]
- [ ] `src/api/[feature_api].py` - [API/インターフェース層]
- [ ] `tests/test_[feature_module].py` - [対応するテストファイル]
- [ ] `config/[feature_config].py` - [設定ファイル（必要時）]

**修正対象**
- [ ] `src/service/[existing_service].py` - [既存サービスの拡張]
  - 関数: `existing_function()` - [統合・拡張内容]
  - クラス: `ExistingService` - [新機能追加]
- [ ] `src/models/[data_models].py` - [データモデルの変更]
  - クラス: `DataModel` - [新規フィールド・メソッド追加]

### 2. インターフェース設計方針
**主要関数シグネチャ**
```python
def [main_function_name](
    input_data: [InputDataType],
    config: [ConfigType] = None,
    **options
) -> [OutputType]:
    """[What で定義した主要機能の説明]
    
    Args:
        input_data: [入力データの説明・制約]
        config: [設定パラメータの説明]
        **options: [追加オプション]
    
    Returns:
        [OutputType]: [出力結果の説明・構造]
    
    Raises:
        [ExceptionType]: [発生条件]
    """
```

**データ型設計**
- `InputDataType`: [DataFrame/dict/list/custom class 等]
- `ConfigType`: [設定の構造・形式]
- `OutputType`: [結果の構造・形式]

**API設計思想**
- **シンプルさ**: [複雑な設定を内部で処理]
- **柔軟性**: [複数の入力形式・オプションに対応]
- **一貫性**: [既存の命名規則・パターンを踏襲]

### 3. アーキテクチャ整合性の確認
**統合方針**
- [ ] **既存パターンとの整合**: [現在のアーキテクチャパターンを踏襲]
- [ ] **依存関係管理**: [新規依存ライブラリの最小化]
- [ ] **設定管理**: [既存の設定パターンとの統一]

**データフロー設計**
- [ ] **入力元**: [データソースの特定]
- [ ] **処理パイプライン**: [既存処理フローへの統合方法]
- [ ] **出力先**: [結果の保存・利用方法]

## 受け入れ基準（開発向け）

### 機能要件
- [ ] **What の実現**: [定義した主要機能が動作する]
- [ ] **Why の達成**: [期待する課題解決が得られる]
- [ ] **既存システムとの統合**: [既存機능と適切に連携する]
- [ ] **エラーハンドリング**: [適切な例外処理と回復機能]

### 品質要件
- [ ] **テスト対象**: [ユニット・統合・エンドツーエンドテストの範囲]
- [ ] **パフォーマンス**: [処理時間・メモリ使用量の目標値]
- [ ] **保守性**: [コードの可読性・拡張性]
- [ ] **セキュリティ**: [入力検証・権限管理の実装]

### 検証方法
**自動テスト（uv + ruff + pyright）**
```bash
# テスト実行
uv run --frozen pytest tests/test_[feature_module].py -v

# カバレッジ付きテスト
uv run --frozen pytest --cov=src --cov-report=html

# コード品質チェック
uv run --frozen ruff check .
uv run --frozen ruff format .
uv run --frozen pyright
```

**手動確認**
1. [主要機能の動作確認手順]
2. [エラーケース・境界値の確認]
3. [既存機能への影響確認]

---

## 次ステップへの引き継ぎ

### アーキテクチャ検討
この分析結果を基に `/user:check-architecture [この仕様書のパス]` を実行

### 実装計画作成準備
- **設計が必要な場合**: `/user:design-architecture [この仕様書のパス]`
- **既存構造で対応可能**: `/user:plan-implementation [この仕様書のパス]`

### GitHub Issue 作成
```bash
gh issue create --title "Feature: $ARGUMENTS" --body "要求分析完了 - 仕様書: [このファイルのパス]"
```
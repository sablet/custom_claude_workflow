---
description: "任意のエリアと期間でBooking.comホテル調査を実行し、テキストデータ取得とマトリクス分析を行う"
allowed-tools: ["mcp__booking-fetcher__fetch_bookingcom_hotels", "Bash", "TodoWrite", "Read", "Write"]
---

# ホテル調査・比較分析コマンド

指定されたエリアと期間でBooking.comからホテル情報を調査し、MCPツールを使用してデータ取得とマトリクス分析を実行します。

## 使用方法
```
/hotel-search <自然言語による検索指定>
```

### 引数説明
- `$ARGUMENTS`: 自然言語での検索条件（エリア名と期間を含む文字列）

### 使用例
```
/hotel-search 旭川に7月下旬から8月下旬
/hotel-search 札幌 8月前半
/hotel-search 東京 来月のお盆期間
/hotel-search 大阪 2025年9月1日から9月5日まで
```

## 実行手順

### 1. 引数解析と検証
```
$ARGUMENTSから以下の情報を抽出：

**エリア名抽出パターン:**
- 都市名（旭川、札幌、東京、大阪、京都、名古屋、福岡など）
- 地域名（北海道、関東、関西、九州など）
- 観光地名（熱海、軽井沢、箱根、湯布院など）

**期間抽出パターン:**
- 月表記: "7月下旬" → 7月20日-31日
- 月表記: "8月前半" → 8月1日-15日
- 月表記: "8月中旬" → 8月10日-20日
- 相対日付: "来月" → 翌月1日-末日
- 相対日付: "お盆期間" → 8月13日-16日
- 絶対日付: "2025年9月1日から9月5日" → 2025-09-01～2025-09-05
- 期間指定: "3泊4日" → 開始日から4日間

**解析失敗時の対応:**
エリア名または期間が特定できない場合は、以下の質問をユーザーに送信：

"申し訳ございませんが、検索条件を正確に把握できませんでした。
以下の情報を教えてください：

1. 検索対象のエリア（都市名・地域名）:
2. 宿泊開始日（YYYY-MM-DD形式）:
3. 宿泊終了日（YYYY-MM-DD形式）:

例: 旭川、2025-07-20、2025-07-23"

ユーザーからの回答を受け取った後、通常の処理フローに進む。
```

### 2. タスク計画の作成
```
TodoWriteツールを使用して以下のタスクを設定：
- 引数解析と検証
- MCPツールでのデータ取得
- データ解析と除外フィルター適用
- マトリクス形式での統合
- 価格帯別推奨分析（1万円以内）
- おすすめホテルランキング生成
```

### 3. MCPツールでのデータ取得
```
mcp__booking-fetcher__fetch_bookingcom_hotels を使用:
- area: 解析されたエリア名
- startDate: 開始日（YYYY-MM-DD形式）
- endDate: 終了日（YYYY-MM-DD形式）

このツールは全てのホテル情報をテキスト形式で返します。
```

### 4. データ処理とフィルタリング
```
MCPツールから取得したテキストデータに対して：

抽出対象:
- ホテル名
- 料金（¥表記）
- 評価点数（10点満点）
- 利用可能性

除外対象:
- ドミトリー
- カプセルホテル
- ホステル
- ゲストハウス
- 民宿
- バックパッカー向け宿泊施設
- 宿泊単価が他と比べて著しく高い宿泊施設

処理手順:
1. MCPツールの出力テキストを解析
2. 除外対象キーワードを含む施設を自動除外
3. 価格情報の正規化
4. 評価スコアの取得
5. 重複データの除去
6. マトリクステーブルの直接生成
```

### 5. マトリクス分析の実行
```markdown
## {エリア名}ホテル予約状況マトリクス（{年月}）

| ホテル名 | {日程1} | {日程2} | {日程3} | 評価 |
|----------|---------|---------|---------|------|
| **ホテルA** | ¥XX,XXX | ¥XX,XXX | ¥XX,XXX | X.X★ |
| **ホテルB** | ¥XX,XXX | - | ¥XX,XXX | X.X★ |

### 📊 分析結果
**価格変動パターン**: 最安日程と価格変動の特徴
**全日程利用可能ホテル**: 安定して予約可能な宿泊施設
**最高評価**: 評価点数トップのホテル
**最安値・最高値**: 価格帯の範囲分析
```

### 6. 価格帯別推奨分析
```
マトリクス出力後、以下の推奨分析を実行：

フィルタリング条件:
- 1泊10,000円以内の宿泊施設を抽出
- 評価点数8.0以上を優先
- 全日程利用可能な施設を優先

処理手順:
1. マトリクスデータから1万円以内の宿泊施設を抽出
2. 評価点数でソート（高い順）
3. 価格の安定性を評価（日程間の価格差）
4. 推奨度スコア算出：
   - 評価点数 × 0.6
   - 価格の安さ（10,000円-平均価格）/10,000円 × 0.3
   - 利用可能日数 / 全日程数 × 0.1

出力形式:
```markdown
## 🏆 コスパ重視おすすめホテル（1泊1万円以内）

### 1位: {ホテル名} ⭐{評価}点
- **推奨理由**: {推奨理由}
- **平均料金**: ¥{平均価格}/泊
- **利用可能日**: {利用可能日数}/{全日程数}日
- **特徴**: 評価が高く価格が安定

### 2位: {ホテル名} ⭐{評価}点
- **推奨理由**: {推奨理由}
- **平均料金**: ¥{平均価格}/泊
- **利用可能日**: {利用可能日数}/{全日程数}日
- **特徴**: {特徴}

### 💡 予約のポイント
- **最安日程**: {日付} - 最大¥{金額}の節約可能
- **価格安定日程**: {日付範囲} - 価格変動が少ない期間
- **予約推奨度**: ★★★★★ （評価・価格・空室状況を総合評価）
```

## データ抽出フィルター仕様

### 除外キーワード（部分一致）
```
除外対象施設タイプ:
- "ドミトリー"
- "カプセル"
- "ホステル" 
- "ゲストハウス"
- "民宿"
- "バックパッカー"
- "シェア"
- "相部屋"
- "簡易宿所"

処理ロジック:
1. ホテル名にこれらのキーワードが含まれる場合は除外
2. 施設説明文に含まれる場合も除外対象
3. 大文字・小文字・ひらがな・カタカナの違いを無視して判定
```

### 対象とする宿泊施設
```
抽出対象:
- ホテル
- ビジネスホテル
- リゾートホテル
- シティホテル
- 旅館
- リゾート
- ペンション
- 民宿（個室タイプのみ）
```

## 技術的な注意事項

### MCPツール使用の利点
```
**重要**: MCPツール mcp__booking-fetcher__fetch_bookingcom_hotels を使用
- 利点: 直接テキストデータを取得（トークン制限なし）
- 効率性: HTMLパース・PDF生成が不要
- 信頼性: 構造化された情報を直接取得
- パフォーマンス: 従来のブラウザ操作より高速
```

### エラーハンドリング
```
- データ解析失敗時はエラーメッセージを表示
- 除外フィルターでデータが0件の場合は警告表示
- ファイル保存失敗時は権限とディレクトリ存在を確認
```

### パフォーマンス最適化
```
- MCPツールからの一括データ取得
- 効率的なテキスト解析
- TodoWriteで進捗管理を徹底
- 除外処理の最適化
- ファイルI/Oの最小化
```

## 実行結果
- 指定エリア・期間のBooking.comデータをMCPツールで取得
- ホテル名×日程のマトリクス表（ドミトリー・カプセル・ホステル除外済み）
- 価格変動分析と推奨情報
- **1泊1万円以内のコスパ重視おすすめホテルランキング**
- **推奨理由と予約のポイントを含む詳細分析**
- 評価点数による宿泊施設ランキング（一般的なホテルのみ）
- 構造化データとレポートファイルの出力

このコマンドにより、任意のエリア・期間での高品質ホテル調査と**予算内での最適な選択肢提案**が体系的に実行可能です。